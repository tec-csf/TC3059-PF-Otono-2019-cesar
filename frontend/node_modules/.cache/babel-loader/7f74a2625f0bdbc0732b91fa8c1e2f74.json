{"ast":null,"code":"import auth0 from 'auth0-js';\nimport jwtDecode from 'jwt-decode';\nconst LOGIN_SUCCESS_PAGE = \"/\";\nconst LOGIN_FAILURE_PAGE = \"/validate\"; // const URL = \"http://localhost:3000\"\n// const URL = \"https://production-riesgocognitivo.azurewebsites.net\"\n\nconst CALLBACK_URL = process.env.REACT_APP_CALLBACK_URL;\nconst AUTH0_URL = process.env.REACT_APP_AUTH0_URL;\nconst AUTH0_DOMAIN = process.env.REACT_APP_AUTH0_DOMAIN;\nconst AUTH0_CLIENT_ID = process.env.REACT_APP_AUTH0_CLIENT_ID;\nexport default class Auth {\n  constructor() {\n    this.auth0 = new auth0.WebAuth({\n      domain: AUTH0_DOMAIN,\n      clientID: AUTH0_CLIENT_ID,\n      redirectUri: CALLBACK_URL,\n      audience: AUTH0_URL + \"/userinfo\",\n      roleUrl: AUTH0_URL + \"/roles\",\n      responseType: \"token id_token\",\n      scope: \"openid profile\"\n    });\n    this.login = this.login.bind(this);\n  }\n\n  login() {\n    // eslint-disable-next-line no-restricted-globals\n    this.auth0.authorize();\n  }\n\n  logout() {\n    // eslint-disable-next-line no-restricted-globals\n    location.pathname = \"/\";\n    localStorage.removeItem(\"acces_token\");\n    localStorage.removeItem(\"id_token\");\n    localStorage.removeItem(\"expires_at\");\n    localStorage.removeItem(\"role\");\n  }\n\n  handleAuthentication() {\n    this.auth0.parseHash((err, authResults) => {\n      if (authResults && authResults.accessToken && authResults.idToken) {\n        let expiresAt = JSON.stringify(authResults.expiresIn) * 1000 + new Date().getTime();\n        localStorage.setItem(\"access_token\", authResults.accessToken);\n        localStorage.setItem(\"id_token\", authResults.idToken);\n        localStorage.setItem(\"expires_at\", expiresAt); // eslint-disable-next-line no-restricted-globals\n\n        location.hash = \"\"; // eslint-disable-next-line no-restricted-globals\n\n        location.pathname = LOGIN_SUCCESS_PAGE;\n      } else if (err) {\n        // eslint-disable-next-line no-restricted-globals\n        location.pathname = LOGIN_FAILURE_PAGE;\n        alert(err.errorDescription);\n        console.log(err);\n      }\n    });\n  }\n\n  isAuthenticated() {\n    let expiresAt = JSON.parse(localStorage.getItem(\"expires_at\"));\n    return new Date().getTime() < expiresAt;\n  }\n\n  getProfile() {\n    if (localStorage.getItem(\"id_token\")) {\n      return jwtDecode(localStorage.getItem(\"id_token\"));\n    } else {\n      return {};\n    }\n  }\n\n}","map":{"version":3,"sources":["/home/cesar/Desktop/Riesgo_Cognitivo/frontend/src/auth0/Auth.js"],"names":["auth0","jwtDecode","LOGIN_SUCCESS_PAGE","LOGIN_FAILURE_PAGE","CALLBACK_URL","process","env","REACT_APP_CALLBACK_URL","AUTH0_URL","REACT_APP_AUTH0_URL","AUTH0_DOMAIN","REACT_APP_AUTH0_DOMAIN","AUTH0_CLIENT_ID","REACT_APP_AUTH0_CLIENT_ID","Auth","constructor","WebAuth","domain","clientID","redirectUri","audience","roleUrl","responseType","scope","login","bind","authorize","logout","location","pathname","localStorage","removeItem","handleAuthentication","parseHash","err","authResults","accessToken","idToken","expiresAt","JSON","stringify","expiresIn","Date","getTime","setItem","hash","alert","errorDescription","console","log","isAuthenticated","parse","getItem","getProfile"],"mappings":"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","sourcesContent":["import auth0 from 'auth0-js';\nimport jwtDecode from 'jwt-decode';\n\nconst LOGIN_SUCCESS_PAGE = \"/\";\nconst LOGIN_FAILURE_PAGE = \"/validate\";\n\n// const URL = \"http://localhost:3000\"\n// const URL = \"https://production-riesgocognitivo.azurewebsites.net\"\nconst CALLBACK_URL = process.env.REACT_APP_CALLBACK_URL\nconst AUTH0_URL = process.env.REACT_APP_AUTH0_URL\nconst AUTH0_DOMAIN = process.env.REACT_APP_AUTH0_DOMAIN\nconst AUTH0_CLIENT_ID = process.env.REACT_APP_AUTH0_CLIENT_ID\n\nexport default class Auth{\n    auth0 = new auth0.WebAuth({\n        domain: AUTH0_DOMAIN,\n        clientID: AUTH0_CLIENT_ID,\n        redirectUri: CALLBACK_URL,\n        audience: AUTH0_URL + \"/userinfo\",\n        roleUrl: AUTH0_URL + \"/roles\",\n        responseType: \"token id_token\",\n        scope: \"openid profile\"\n    });\n\n    constructor(){\n        this.login = this.login.bind(this);\n    }\n\n    login(){\n        // eslint-disable-next-line no-restricted-globals\n        this.auth0.authorize()\n    }\n\n    logout(){\n        // eslint-disable-next-line no-restricted-globals\n        location.pathname = \"/\";\n        localStorage.removeItem(\"acces_token\");\n        localStorage.removeItem(\"id_token\");\n        localStorage.removeItem(\"expires_at\");\n        localStorage.removeItem(\"role\");\n    }\n\n    handleAuthentication(){\n        \n        this.auth0.parseHash((err, authResults) =>{\n            if (authResults && authResults.accessToken && authResults.idToken){\n                let expiresAt = JSON.stringify(authResults.expiresIn) * 1000 + new Date().getTime();\n                localStorage.setItem(\"access_token\", authResults.accessToken);\n                localStorage.setItem(\"id_token\", authResults.idToken);\n                localStorage.setItem(\"expires_at\", expiresAt);\n                // eslint-disable-next-line no-restricted-globals\n                location.hash = \"\";\n                // eslint-disable-next-line no-restricted-globals\n                location.pathname = LOGIN_SUCCESS_PAGE;\n            } else if (err){\n                // eslint-disable-next-line no-restricted-globals\n                location.pathname = LOGIN_FAILURE_PAGE;\n                alert(err.errorDescription);\n                console.log(err);\n            }\n        })\n    }\n\n    isAuthenticated(){\n        let expiresAt = JSON.parse(localStorage.getItem(\"expires_at\"));\n        return new Date().getTime() < expiresAt;\n    }\n\n    getProfile(){\n        \n        if(localStorage.getItem(\"id_token\")){\n            return jwtDecode(localStorage.getItem(\"id_token\"));\n\n        }else{\n            return{};\n        }\n    }\n}\n"]},"metadata":{},"sourceType":"module"}